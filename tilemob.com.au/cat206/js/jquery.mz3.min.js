/*
 MegaZine3 jQuery Plugin v0.1
 This file is part of the MegaZine3 engine.
 Copyright (C) 2007-2011, VservU GmbH (Florian Nuecke and Hans J. Nuecke)
 License: http://www.megazine3.de/license
*/
var j=null;function k(){return function(){}}function o(a){return function(){return a}}
(function(a){function t(b,a){return typeof b==="undefined"||b===j?a:typeof b==="string"?b:String(b)}function p(b,a){return typeof b==="undefined"||b===j?a:typeof b==="boolean"?b:b.toLowerCase()==="true"||b.toLowerCase()==="yes"||b==="1"}function I(b,a){return typeof b==="undefined"||b===j?a:typeof b==="number"?b:Number(b)}function J(a,g){return typeof a==="undefined"||a===j?g:typeof a==="object"?a:a.split(",")}function A(a,g){return!a?g:g.match(/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/)[1]?
g:a.charAt(a.length-1)!=="/"&&g.charAt(0)!=="/"?a+"/"+g:a+g}function K(a){var g=[];if(a)for(var n in a.attributes)isNaN(n)||g.push(a.attributes[n].name);return g}function L(b,g,n,u,l,p){var m;typeof n==="undefined"&&(n="");typeof u==="undefined"&&(u=!0);typeof l==="undefined"&&(l=!0);typeof p==="undefined"&&(p=!0);if(typeof m==="undefined")if(langsAvailable=(b.attr("lang")||"en").split(","),langsAvailable.length<2)m=langsAvailable[0];else{$langSelect=a("<p>"+document.mz3js.lang_select_query+'</p><select/><button type="button">'+
document.mz3js.lang_select_ok+"</button>");for(var v=0;v<langsAvailable.length;++v)m=langsAvailable[v],$langSelect.filter("select").append(a('<option value="'+m+'">'+document.mz3js.langs[m]+"</option>"));$langSelect.filter("button").click(function(){$langSelect.remove();m=$langSelect.filter("select").val();new w(b,g,n,u,l,p,m)});g.append($langSelect);return}new w(b,g,n,u,l,p,m)}function w(b,g,n,u,l,G,m){function v(){if(l){a("head > meta[name=viewport]").attr("content","width=device-width,minimum-scale=1.0,maximum-scale=1.0");
var h=c.get("pagewidth"),b=c.get("pageheight"),h=g.width()/(i?h*2:h),b=g.height()/b,b=Math.min(1,h,b);a("head > meta[name=viewport]").attr("content","width=device-width,maximum-scale="+b+",minimum-scale="+b)}}var q=j,e=[],i="invalid",r=j,c={a:function(a,b,c){c||(c=typeof b==="number"?I:typeof b==="boolean"?p:t);this[a]={value:b,h:c}},set:function(a,b){if(typeof this[a]!=="undefined")this[a].value=this[a].h?this[a].h(b,this[a].value):b},get:function(a){return this[a].value}};this.g=function(a){if(Boolean(a)!==
i){var b=this.getCurrentPage();r.stop();i=Boolean(a);a=c.get("pagewidth");i?(q.css("width",a*2+"px"),q.css("margin-left","-"+a+"px"),q.find(".mz3-page-container").css("width",e.length*a+"px"),q.find(".mz3-page-spread:first-child,.mz3-page-spread:last-child").css("width",a*2),r.options.snap=".mz3-pageside-odd",b+=b%2):(q.css("width",a+"px"),q.css("margin-left","-"+a/2+"px"),q.find(".mz3-page-container").css("width",(e.length-1)*a+"px"),q.find(".mz3-page-spread:first-child,.mz3-page-spread:last-child").css("width",
a),r.options.snap=".mz3-pageside");v();var g=this;setTimeout(function(){r.refresh();g.gotoPage(b,!0)},0)}};this.gotoPage=function(a,b){a<0?a=0:a>e.length-2&&(a=e.length-2);a=(a+(i?a%2:0))/(i?2:1);b?r.scrollToPage(a,0,1):r.scrollToPage(a,0,c.get("dragspeed")*1E3)};this.gotoPreviousPage=function(a){this.gotoPage(this.getCurrentPage()-(i?2:1),a)};this.gotoNextPage=function(a){this.gotoPage(this.getCurrentPage()+(i?2:1),a)};this.gotoFirstPage=function(a){this.gotoPage(0,a)};this.gotoLastPage=function(a){this.gotoPage(e.length,
a)};this.getCurrentPage=function(){return i?r.currPageX*2:r.currPageX};this.getPageCount=function(){return e.length};this.getPageHeight=function(){return c.get("pageheight")};this.getPageWidth=function(){return c.get("pagewidth")};this.getFlipState=o("megazine_flip_state_ready");this.getLoadState=o("megazine_load_state_loaded");this.gotoNextChapter=k();this.gotoPreviousChapter=k();this.hasShadows=o(!1);this.hasReflection=o(!1);this.isCornerHintingEnabled=o(!1);this.getInstantJumpCount=o(0);this.isDraggingEnabled=
o(!0);this.isTurningEnabled=o(!0);this.isMuted=o(!1);this.setCornerHintingEnabled=k();this.setDraggingEnabled=k();this.setTurningEnabled=k();this.setInstantJumpCount=k();this.setMuted=k();this.setShadows=k();this.setReflection=k();this.getRotation=o(0);this.setRotation=k();this.getZoom=o(1);this.setZoom=k();this.getLiquidScaling=o(!1);this.setLiquidScaling=k();this.zoomIn=k();this.zoomOut=k();this.zoomFit=k();this.addChapter=k();this.addChapterAt=k();this.addPage=k();this.addPageIn=k();this.addPageAt=
k();this.removeChapter=k();this.removePage=k();this.getLanguage=o("en");this.setLanguage=k();this.getAllLanguages=function(){return["en"]};(function(h){function i(b){function c(a,d){var b=a.find(d+"[lang="+m+"],"+d+":not([lang])");return b.length>0?b[0].textContent:typeof a.attr(d)!=="undefined"?a.attr(d):j}function g(b,d){c(b,"width")!==j&&d.css("width",c(b,"width")+"px");c(b,"height")!==j&&d.css("height",c(b,"height")+"px");var e=c(b,"url");e!==j&&(e=A(n,e),$a=a("<a/>"),$a.css("width",d.css("width")),
$a.css("height",d.css("height")),$a.attr("href",e),d.wrap($a),d=$a);d.css("position","absolute");d.css("left",0);d.css("top",0);c(b,"position")!==j&&c(b,"position").split(" ").forEach(function(a){switch(a){case "center":d.css("left","50%");d.css("margin-left","-"+d.width()/2+"px");break;case "right":d.css("right",0);break;case "middle":d.css("top","50%");d.css("margin-top","-"+d.height()/2+"px");break;case "bottom":d.css("bottom",0)}});c(b,"left")!==j&&(d.css("margin-left",""),d.css("right",""),d.css("left",
c(b,"left")+"px"));c(b,"top")!==j&&(d.css("margin-top",""),d.css("bottom",""),d.css("top",c(b,"top")+"px"));return d}var e=B;typeof b.attr("bgcolor")!=="undefined"&&(e=Number(b.attr("bgcolor")),e=e.toString(16),e="#"+e.substring(e.length-6));var l=b[0].tagName.toLowerCase()==="spreadpage",f=a("<div/>");f.css({position:"absolute",overflow:"hidden","background-color":e,height:C+"px",width:(l?x*2:x)+"px"});f.addClass("mz3-pageside");D%2&&f.addClass("mz3-pageside-odd");f.data("pagenumber",D);var h={area:function(b){if(c(b,
"url")===j)return j;if(!(c(b,"width")===j||c(b,"height")===j)){var d=a("<div/>");return g(b,d)}},gif:function(a){return h.i(a)},img:function(b){var d=c(b,"src-alt")||c(b,"src");if(d)d=A(n,d);else return j;var e=a("<img/>");e.addClass("mz3-img");e.load(function(){e.css("width",this.naturalWidth+"px");e.css("height",this.naturalHeight+"px");g(b,e)});e.attr("src","images/blank.gif");e.data("src",d);return e},nav:o(j),snd:o(j),vid:function(b){var d={e:c(b,"src"),b:c(b,"src-alt-h264"),f:c(b,"src-alt-ogg"),
d:c(b,"src-alt-webm")},e={b:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',f:'video/ogg; codecs="theora, vorbis"',d:'video/webm; codecs="vp8, vorbis"'};if(!d.e&&!d.b&&!d.f&&!d.d)return j;else for(var f in d)d[f]&&(d[f]=A(n,d[f]));var i=a("<div/>"),h;if(G){h=a("<a/>");h.css("display","block");var l=c(b,"preview"),m=a("<img/>");m.addClass("mz3-img");m.attr("src","images/blank.gif");l?m.data("src",A(n,l)):m.data("src","images/video.png");m.css("width","100%");m.css("height","100%");h.append(m);l=navigator.userAgent.match(/iPhone/i)||
navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/Safari/i)&&!navigator.userAgent.match(/Chrome/i)?d.b:d.d;if(!l)for(f in d)if(d[f]){l=d[f];break}h.attr("href",l)}else h=a("<video/>");h.css("width","100%");h.css("height","100%");i.append(h);if(G)$element=g(b,i);else{p(c(b,"loop"),!0)&&h.attr("loop","loop");p(c(b,"autoplay"),!0)&&!c(b,"preview")&&h.attr("autoplay","autoplay");(window.orientation||c(b,"gui"))&&h.attr("controls","controls");h.one("loadedmetadata",function(){i.css("width",
this.videoWidth+"px");i.css("height",this.videoHeight+"px");var c=!1;a(this).click(function(){c?this.pause():this.play();c=!c});i.parent()[0].tagName.toLowerCase()==="a"&&i.unwrap();g(b,i)});h.one("error",k());$element=g(b,i);for(f in d)f==="flash"?d.e&&!d.b&&!d.f&&!d.d&&h.attr("src",d.e):d[f]&&($source=a("<source/>"),$source.attr("src",d[f]),$source.attr("type",e[f]),h.append($source));h[0].load()}return $element}};b.children().each(function(){var b=this.tagName.toLowerCase();h[b]?f.append(h[b](a(this))):
console&&console.log&&console.log('Unknown element of type "'+b+'".')});++D;return f}function t(){var b=a("<div/>");b.css("position","absolute");b.css("width",x*2+"px");b.css("height",C+"px");var c=a("<div/>");c.css("position","relative");c.css("width","100%");c.css("height","100%");b.append(c);c.append(f[0]).append(f[1]);e.push(f[0]);e.push(f[1]);f=[j,j]}function w(){var b=h.getCurrentPage();if(b!=H){var e=c.get("maxloaded"),f=b-Math.floor(e/2),g=b+Math.floor((e-1)/2);q.find(".mz3-pageside").each(function(){var b=
a(this).data("pagenumber");b<f||b>g?a(this).find("img.mz3-img").attr("src","images/blank.gif"):a(this).find("img.mz3-img").each(function(){a(this).attr("src",a(this).data("src"))})});H=b}}c.a("startpage",0);c.a("pageoffset",0);c.a("dragspeed",0.3);c.a("clickrange",0);c.a("ignoresides",!1);c.a("dragarea",["top","middle","bottom"],J);c.a("loop",!1);c.a("centercovers",!0);c.a("rotate",0);c.a("zoommaxscale",1);c.a("zoomminscale",1);c.a("ltr",!0);c.a("maxloaded",22);c.a("bgcolor",4291611852);c.a("pageheight",
400);c.a("pagewidth",275);K(b[0]).forEach(function(a){c.set(a,b.attr(a))});var x=c.get("pagewidth"),C=c.get("pageheight"),B=c.get("bgcolor"),B=B.toString(16),B="#"+B.substring(B.length-6),f=[j,j],D=0;b.find("page, spreadpage").each(function(){if(this.tagName.toLowerCase()==="spreadpage")D%2===0&&(f[1]=i(a("<page/>")),t()),f[0]=i(a(this)),f[1]=i(a("<page/>")),f[1].css("visibility","hidden");else if(D%2===0)f[1]=i(a(this));else{f[0]=i(a(this));return}t()});(f[0]||f[1])&&t();var y=a("<div/>");y.css({position:"absolute",
width:x+"px",height:C+"px",left:"50%",top:"50%","margin-left":"-"+x/2+"px","margin-top":"-"+C/2+"px"});g.append(y);var E=a("<div/>");E.css({position:"relative",overflow:"hidden",width:"100%",height:"100%"});y.append(E);var s=a("<div/>");s.css({position:"absolute",height:C+"px",width:(e.length-1)*x+"px"});s.addClass("mz3-page-container");E.append(s);var z=a("<div/>");z.css({position:"relative",height:"100%",width:"100%"});s.append(z);z.append(a("<div/>").addClass("mz3-pageside-odd").css({width:"1px",
height:"1px"}));for(s=0;s<e.length;s+=1)e[s]&&(e[s].css("left",s*x+"px"),z.append(e[s]));z="mz3pc"+Math.floor(Math.random()*1E9);E.attr("id",z);r=new iScroll(z,{zoom:!1,zoomMax:c.get("zoommaxscale")});q=y;h.gotoPage(0,!0);l&&(a("head > meta[name=viewport]").length===0&&a("head").append(a('<meta name="viewport" content="" />')),v());if(u){var F;"onorientationchange"in window?(F=function(){return(window.orientation+360)%360%180},y="orientationchange"):(F=function(){return a(window).width()>a(window).height()},
y="resize");a(window).bind(y,function(){h.g(F())});h.g(F())}window.MegaZine&&(MegaZine.getMovie=function(){return h});var H=-1;setInterval(function(){w()},1E3);w()})(this)}a.fn.mz3js=function(){if(this&&this.length!==0){var b=this,g=this.attr("id"),n=t(this.attr("data-mz3-swf"),"megazine/preloader.swf"),u=t(this.attr("data-mz3-xml"),"megazine.mz3"),l=t(this.attr("data-mz3-basepath"),""),w=p(this.attr("data-mz3-autoadjust"),!0),m=p(this.attr("data-mz3-viewport"),!0),v=p(this.attr("data-mz3-logtojs"),
!1),q=t(this.attr("data-mz3-wmode"),""),e=t(this.attr("data-mz3-bgcolor"),"#33333"),i=p(this.attr("data-mz3-linkvids"),!0),r=p(this.attr("data-mz3-forcejs"),!1),c=p(this.attr("data-mz3-nojs"),!1);if(u){try{if(!window.swfobject)throw"MegaZine3 requires swfobject to initialize Flash.";if(!r&&swfobject.hasFlashPlayerVersion("10.0.0")){swfobject.embedSWF(n,g,"100%","100%","10.0.0","js/expressInstall.swf",{basePath:l,xmlFile:u,logToJsConsole:String(v)},{wmode:q,menu:"false",scale:"noScale",allowFullscreenInteractive:"true",
allowScriptAccess:"always",bgcolor:e},{id:g});window.MegaZine&&(MegaZine.megazine=g);return}}catch(h){console&&console.warn&&console.warn("Could not embed Flash: "+h)}if(!c||r)l=A(n.substring(0,n.lastIndexOf("/")+1),l),a.ajax({url:A(l,u),dataType:"xml",success:function(c){b.empty();b.css({position:"relative","background-color":e});b.addClass("mz3");L(a(c.documentElement),b,l,w,m,i)}})}}}})(jQuery);
